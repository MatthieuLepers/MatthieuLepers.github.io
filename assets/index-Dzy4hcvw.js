var _=Object.defineProperty;var F=(n,t,e)=>t in n?_(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var o=(n,t,e)=>F(n,typeof t!="symbol"?t+"":t,e);import{f as b,d as j,u as I,r as E,g as N,w as C,o as B,h as H,a as y,n as L,i as U,c as T,b as m,j as k,k as M,l as f,p as g,q as W,e as x,m as D}from"./index-Ekf_6C_P.js";import{U as Q}from"./index-DXbHYBQB.js";class Y{constructor(){o(this,"id",crypto.randomUUID());o(this,"enabled",!0)}}function R(n=0,t=1){let e=0,s=0;for(;e===0;)e=Math.random();for(;s===0;)s=Math.random();return n+t*Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*s)}class r{constructor(t=0,e=0){this.x=t,this.y=e}negate(){return new r(-this.x,-this.y)}add(t){return new r(this.x+t.x,this.y+t.y)}sub(t){return this.add(t.negate())}mult(t){return new r(this.x*t,this.y*t)}div(t){return new r(this.x/t,this.y/t)}clamp(t,e){return new r(Math.max(t,Math.min(e,this.x)),Math.max(t,Math.min(e,this.y)))}length(){return Math.hypot(this.x,this.y)}normalize(){return this.div(this.length())}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}static randomPointAround(t,e){const s=2*Math.PI*Math.random(),a=Math.sqrt(Math.random())*e;return new r(t.x+a*Math.cos(s),t.y+a*Math.sin(s))}static generateGaussianPoint(t,e){return new r(R(t.x,e),R(t.y,e))}static generatePoint(t,e){return new r(Math.random()*t,Math.random()*e)}}class v{constructor(t,e,s,a){this.x=t,this.y=e,this.width=s,this.height=a}get minCorner(){return new r(this.x,this.y)}get maxCorner(){return new r(this.x+this.width,this.y+this.height)}get center(){return this.minCorner.add(this.maxCorner).mult(.5)}render(t){t.save(),t.strokeStyle="#f00",t.strokeRect(this.x,this.y,this.width,this.height),t.restore()}}const d=class d{constructor(t,e=0){o(this,"nodes",[]);o(this,"particles",[]);this.bounds=t,this.depth=e}static create({x:t,y:e,width:s,height:a}){return new d(new v(t,e,s,a))}get centerOfMass(){const t=this.particles.length>0?this.particles.reduce((s,a)=>s+a.mass,0):this.nodes.reduce((s,a)=>s+a.centerOfMass.mass,0);return{position:this.particles.length>0?this.particles.reduce((s,a)=>s.add(a.position.mult(a.mass)),new r).div(t):this.nodes.reduce((s,a)=>s.add(a.centerOfMass.position.mult(a.centerOfMass.mass)),new r).div(t),mass:t}}clear(){this.particles=[],this.nodes.forEach(t=>{t.clear()}),this.nodes=[]}subdivide(){const{x:t,y:e,width:s,height:a}=this.bounds,i=s/2,h=a/2;this.nodes=[new d(new v(t,e,i,h),this.depth+1),new d(new v(t+i,e,i,h),this.depth+1),new d(new v(t,e+h,i,h),this.depth+1),new d(new v(t+i,e+h,i,h),this.depth+1)]}getChildIndex(t){const{center:e}=this.bounds;return t.position.x===e.x||t.position.y===e.y?-1:(t.position.x>e.x?1:0)+(t.position.y>e.y?2:0)}insert(t){if(this.nodes.length){const e=this.getChildIndex(t);if(e!==-1){this.nodes[e].insert(t);return}}if(this.particles.push(t),this.particles.length>d.MAX_PARTICLES&&this.depth<d.MAX_DEPTH){this.nodes.length||this.subdivide();const e=this.particles;this.particles=[];for(let s=0;s<e.length;s+=1){const a=e[s],i=this.getChildIndex(a);i===-1?this.particles.push(a):this.nodes[i].insert(a)}}}insertAll(t){t.forEach(e=>{this.insert(e)})}retrieve(t){let e=[];const s=this.getChildIndex(t);return s>=0&&this.nodes[s]&&(e=e.concat(this.nodes[s].retrieve(t))),e.concat(this.particles)}render(t){if(this.bounds.render(t),this.nodes.forEach(e=>e.render(t)),this.particles.length){t.save(),t.fillStyle="#00f";const e=t.measureText(this.particles.length.toString());t.fillText(this.particles.length.toString(),this.bounds.x+this.bounds.width/2-e.width/2,this.bounds.y+this.bounds.height/2,this.bounds.width),t.beginPath(),t.arc(this.centerOfMass.position.x,this.centerOfMass.position.y,2,0,2*Math.PI),t.fill(),t.restore()}}computeGravity(){if(this.nodes.length)this.nodes.forEach(t=>t.computeGravity());else{const t=this.particles.map(e=>this.particles.reduce((s,a)=>e!==a?s.add(e.computeGravitationalForce(a)):s,new r));this.particles.forEach((e,s)=>{e.applyForce(t[s])})}}computeCollision(){this.nodes.length?this.nodes.forEach(t=>{t.computeCollision()}):this.particles.forEach(t=>{this.particles.forEach(e=>{t!==e&&t.collideWith(e)&&(t.mass>e.mass?(t.mergeWith(e),this.particles.splice(this.particles.indexOf(e),1)):(e.mergeWith(t),this.particles.splice(this.particles.indexOf(t),1)))})})}removeFarParticles(t){this.nodes.length?this.nodes.forEach(e=>{e.removeFarParticles(t)}):this.particles.filter(e=>e.position.distance(this.centerOfMass.position)>=t).forEach(e=>{this.particles.splice(this.particles.indexOf(e),1)})}getParticles(){return this.nodes.length?[...this.particles,...this.nodes.reduce((t,e)=>[...t,...e.getParticles()],[])]:this.particles}};o(d,"MAX_PARTICLES",25),o(d,"MAX_DEPTH",8);let G=d;const X=667e-7,A=10,S=1e5,$=S*.08,z=3*S,P={PARTICLE:(n,t)=>{n.fillStyle=t.color,t.drawArc.call(t,n)},STAR:(n,t)=>{n.fillStyle=t.getRadialGradient(n),t.drawArc(n)},BLACK_HOLE:(n,t)=>{n.strokeStyle=t.strokeColor,n.fillStyle=t.color,t.drawArc(n),n.stroke()}};class K{constructor({position:t,velocity:e,color:s,mass:a,size:i,canvas:h,type:w=0,draw:l=P.PARTICLE}){o(this,"position");o(this,"velocity");o(this,"color");o(this,"strokeColor");o(this,"mass");o(this,"size");o(this,"canvas");o(this,"type",0);o(this,"draw");this.position=t,this.velocity=e,this.color=s,this.mass=a,this.size=i,this.canvas=h,this.type=w,this.draw=l}get isStar(){return this.type!==0}applyForce(t){this.velocity=this.velocity.add(t.div(this.mass)).clamp(-A,A),this.update()}computeGravitationalForce(t){const e=t.position.sub(this.position),s=Math.max(e.length(),.1),a=X*this.mass*t.mass/s**2;return e.normalize().mult(a)}collideWith(t){return this.position.distance(t.position)<this.size+t.size}mergeWith(t){const e=this.mass+t.mass;this.position=new r((this.position.x*this.mass+t.position.x*t.mass)/e,(this.position.y*this.mass+t.position.y*t.mass)/e),this.velocity=new r((this.velocity.x*this.mass+t.velocity.x*t.mass)/e,(this.velocity.y*this.mass+t.velocity.y*t.mass)/e),this.mass+=t.mass,this.mass>=$&&this.mass<S&&this.becomeRedDwarf(),this.mass>=S&&this.mass<z&&this.becomeYellowDwarf(),this.mass>=z&&(this.strokeColor?(this.size+=Math.cbrt(t.size)/t.mass,this.size>=this.canvas.height-20&&b.actions.acquireByProject("Gravity Simulation","gargantua")):this.becomeBlackHole())}update(){this.position=this.position.add(this.velocity),this.isStar&&((this.position.x-this.size<0||this.position.x+this.size>this.canvas.width)&&(this.velocity.x*=-.01,this.position.x=Math.max(this.size,Math.min(this.canvas.width-this.size,this.position.x))),(this.position.y-this.size<0||this.position.y+this.size>this.canvas.height)&&(this.velocity.y*=-.01,this.position.y=Math.max(this.size,Math.min(this.canvas.height-this.size,this.position.y))))}getRadialGradient(t){const e=t.createRadialGradient(this.position.x,this.position.y,0,this.position.x,this.position.y,this.size*2);return e.addColorStop(0,this.color),e.addColorStop(1,"transparent"),e}drawArc(t){t.beginPath(),t.arc(this.position.x,this.position.y,this.size,0,2*Math.PI),t.fill()}becomeRedDwarf(){this.color!=="#ff4d3b"&&(this.type=1,this.size=3,this.color="#ff4d3b",this.draw=P.STAR,b.actions.acquireByProject("Gravity Simulation","red_dwarf"))}becomeYellowDwarf(){this.color!=="#ff0"&&(this.size=5,this.color="#ff0",this.draw=P.STAR,b.actions.acquireByProject("Gravity Simulation","yellow_dwarf"))}becomeBlackHole(){this.color!=="#000"&&(this.size=2,this.color="#000",this.strokeColor="#fff",this.draw=P.BLACK_HOLE,b.actions.acquireByProject("Gravity Simulation","black_hole"))}render(t){t.save(),this.draw(t,this),t.restore()}}class J extends Y{constructor(e,s){super();o(this,"particles",[]);o(this,"ctx",null);o(this,"quadTree");o(this,"options",{drawQuadTree:!1,trackCenterOfMass:!1});this.canvas=e,this.scene=s,this.enabled=!1}setCanvasSize(e,s){this.canvas&&(this.canvas.width=e,this.canvas.height=s,this.quadTree||(this.quadTree=G.create({x:0,y:0,width:e,height:s})))}createParticleAt(e,s={}){return new K({position:e,velocity:new r(Math.random()*2-1,Math.random()*2-1),color:"#fff",mass:Math.random()*1e3,size:1,canvas:this.canvas,...s})}init(){if(this.canvas){const{width:e,height:s}=this.canvas;this.particles=[...Array(1e3).keys()].map(()=>this.createParticleAt(r.generatePoint(e,s)))}}async frame(){this.canvas&&(this.ctx?(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.quadTree.clear(),this.quadTree.insertAll(this.particles),this.quadTree.computeGravity(),this.quadTree.computeCollision(),this.quadTree.removeFarParticles(this.canvas.height),this.particles=this.quadTree.getParticles(),this.options.trackCenterOfMass&&(this.ctx.save(),this.ctx.translate(this.canvas.width/2-this.quadTree.centerOfMass.position.x,this.canvas.height/2-this.quadTree.centerOfMass.position.y)),this.particles.forEach(e=>{e.render(this.ctx)}),this.options.trackCenterOfMass&&this.ctx.restore(),this.options.drawQuadTree&&this.quadTree.render(this.ctx)):this.ctx=this.canvas.getContext("2d"))}}const Z={key:0,class:"scene__controls"},V=["title"],tt=["title"],et=["title"],st=["title"],it=j({__name:"Scene",setup(n){var w;const{t}=I(),e=E(null),s=E(null),a=(w=H())==null?void 0:w.uid,i=N({task:null,mouseTask:null,mousePos:new r,drawQuadTree:!1,trackCenterOfMass:!1,started:!1}),h={reset(){i.task&&i.task.init()}};return C(()=>i.drawQuadTree,l=>{i.task.options.drawQuadTree=l}),C(()=>i.trackCenterOfMass,l=>{i.task.options.trackCenterOfMass=l}),C(()=>i.started,l=>{i.task.enabled=l}),B(async()=>{var p;i.task=new J(s.value,e.value),i.mouseTask={id:`mousetask${a}`,enabled:!1,async frame(){if(this.enabled){const c=[...Array(3).keys()].map(()=>i.task.createParticleAt(r.randomPointAround(i.mousePos,10)));i.task.particles.push(...c)}}},y.processManager.addTask(i.task),y.processManager.addTask(i.mouseTask),(p=s.value)==null||p.addEventListener("mousedown",c=>{c.preventDefault(),c.stopPropagation(),i.mouseTask.enabled=!0;const{x:O,y:q}=s.value.getBoundingClientRect();i.mousePos=new r(c.clientX-O,c.clientY-q)}),window.addEventListener("mouseup",()=>{i.mouseTask.enabled=!1}),await L();const{width:l,height:u}=e.value.closest(".carousel__slide").getBoundingClientRect();i.task.setCanvasSize(l,u),i.task.init(),await i.task.frame(),await i.task.frame()}),U(()=>{y.processManager.removeTask(i.task),y.processManager.removeTask(i.mouseTask)}),(l,u)=>{const p=W("icon");return x(),T("div",{class:g(l.GenerateModifiers("scene",{"gravity-simulation":!0})),ref_key:"scene",ref:e},[m("canvas",{ref_key:"canvas",ref:s},null,512),i.started?(x(),T("div",Z,[m("button",{class:g(l.GenerateModifiers("scene__btn",{reset:!0})),type:"button",title:f(t)("Project.GravitySimulation.regenerate"),onClick:u[0]||(u[0]=M((...c)=>h.reset&&h.reset(...c),["prevent","stop"]))},[k(m("span",null,null,512),[[p,void 0,"refresh"]])],10,V),m("button",{class:g(l.GenerateModifiers("scene__btn",{grid:!0,on:i.drawQuadTree})),type:"button",title:i.drawQuadTree?f(t)("Project.GravitySimulation.hideQuadTree"):f(t)("Project.GravitySimulation.showQuadTree"),onClick:u[1]||(u[1]=M(c=>i.drawQuadTree=!i.drawQuadTree,["prevent","stop"]))},[k(m("span",null,null,512),[[p,void 0,"grid"]])],10,tt),m("button",{class:g(l.GenerateModifiers("scene__btn",{track:!0,on:i.trackCenterOfMass})),type:"button",title:i.trackCenterOfMass?f(t)("Project.GravitySimulation.untrackCenterOfMass"):f(t)("Project.GravitySimulation.trackCenterOfMass"),onClick:u[2]||(u[2]=M(c=>i.trackCenterOfMass=!i.trackCenterOfMass,["prevent","stop"]))},[k(m("span",null,null,512),[[p,void 0,"crosshair"]])],10,et)])):(x(),T("div",{key:1,class:g(l.GenerateModifiers("scene__controls",{fullscreen:!0}))},[m("button",{class:g(l.GenerateModifiers("scene__btn",{start:!0})),type:"button",title:f(t)("Project.GravitySimulation.start"),onClick:u[3]||(u[3]=M(c=>i.started=!0,["prevent","stop"]))},[k(m("span",null,null,512),[[p,void 0,"play"]])],10,st)],2))],2)}}}),ot={name:{"fr-FR":"Gravity Simulation","en-EN":"Gravity Simulation"},description:{"fr-FR":["Simulation gravitationnelle N-corps développée avec WebGPU, exploitant le calcul massivement parallèle côté navigateur.","Implémentation optimisée pour gérer jusqu’à 10 millions de particules : gestion mémoire, représentation des champs et performance à grande échelle.","Démonstration technique des capacités GPU modernes appliquées à la simulation physique temps réel.","Vous pouvez essayer la version 2D dans le carrousel."].join(`
`),"en-EN":["N-body gravitational simulation built with WebGPU, leveraging massively parallel computation in the browser.","Optimized implementation capable of handling up to 10 million particles: memory management, field representation and large-scale performance.","Technical demonstration of modern GPU capabilities applied to real-time physical simulation.","You can try the 2D version in the slider."].join(`
`)},link:"/gravity-simulation",scene:D(it),github:"https://github.com/MatthieuLepers/gravity-simulation",medias:["/img/projects/gravity-simulation.png","/img/projects/gravity-simulation-gaussian.png","/img/projects/gravity-simulation-gaussian-disc.png","/img/projects/gravity-simulation-gaussian-disc-max.png"],navigationSvg:Q,navigationOnClick(){y.actions.scrollToScreen(4,"navigation")},technologies:[{logo:"/img/svg/webgpu.svg",label:"WebGPU"},{logo:"/img/svg/typescript.svg",label:"TypeScript"},{logo:"/img/svg/sass.svg",label:"SASS"},{logo:"/img/svg/vitejs.png",label:"Vite"}],deployment:[{logo:"/img/svg/github.svg",label:"GitHub",tooltip:{"fr-FR":"GitHub Pages via GitHub Actions","en-EN":"GitHub Pages using GitHub Actions"}}],tools:[{logo:"/img/svg/chatgpt.svg",label:"ChatGPT",tooltip:{"fr-FR":"Montée en compétence WebGPU & Assistant technique","en-EN":"WebGPU Skills Development & Technical Support"}}],order:4},lt={red_dwarf:{name:{"fr-FR":"Naine rouge","en-EN":"Red dwarf"},description:{"fr-FR":"Vous avez vu naître une petite étoile de la catégorie des naines rouges !","en-EN":"You have witnessed the birth of a little star in the red dwarf category!"},order:0,clue:{"fr-FR":"Patience, la graviter travaille...","en-EN":"Patience, gravity is slowly working..."},image:"/img/achievements/icon-red.png"},yellow_dwarf:{name:{"fr-FR":"Naine jaune","en-EN":"Yellow dwarf"},description:{"fr-FR":"Vous avez vu naître une étoile de la catégorie des naines jaunes, comme notre Soleil !","en-EN":"You have witnessed the birth of a star in the yellow dwarf category, like our Sun!"},order:1,clue:{"fr-FR":"Celle-ci semble plus rare...","en-EN":"This one seems to be rarer..."},image:"/img/achievements/icon-yellow.png"},black_hole:{name:{"fr-FR":"Trou noir","en-EN":"Black Hole"},description:{"fr-FR":"C’est le destin des étoiles trop massives.","en-EN":"That’s the fate of stars that are too massive."},order:2,clue:{"fr-FR":"La gravité l’emporte","en-EN":"Gravity prevails"},image:"/img/achievements/icon-black_hole.png"},gargantua:{name:{"fr-FR":"Gargantua","en-EN":"Gargantua"},description:{"fr-FR":"Il semblerai que vous ayez vu Interstellar","en-EN":"It seems you’ve seen Interstellar"},order:3,clue:{"fr-FR":"???","en-EN":"???"},image:"/img/achievements/icon-black_hole.png",hidden:!0}};export{lt as achievements,ot as project};
