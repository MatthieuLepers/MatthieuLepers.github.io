<template>
  <g>
    <g id="MoonBack" transform="translate(26.55 26.55)">
      <path d="M6.41862 14.1364C9.61415 15.2034 13.0696 13.4778 14.1365 10.2823C15.2034 7.08677 13.4779 3.63136 10.2823 2.56443C7.08681 1.49749 3.63141 3.22305 2.56447 6.41858C1.49753 9.6141 3.2231 13.0695 6.41862 14.1364Z" fill="#A9C7C2"/>
      <path opacity="0.5" d="M3.38397 11.8581C9.07497 14.0745 12.7124 12.3371 14.2331 6.83547C14.9905 9.93488 13.6293 12.7486 10.7826 14.0121C8.09414 15.1176 5.12204 14.2307 3.38397 11.8581Z" fill="black"/>
      <path d="M6.41862 14.1364C9.61415 15.2034 13.0696 13.4778 14.1365 10.2823C15.2034 7.08677 13.4779 3.63136 10.2823 2.56443C7.08681 1.49749 3.63141 3.22305 2.56447 6.41858C1.49753 9.6141 3.2231 13.0695 6.41862 14.1364Z" stroke="white" stroke-miterlimit="10"/>
    </g>
    <g id="Earth" class="planet">
      <path d="M3.1 29.5001C2.6 33.4001 2.9 37.5001 4 41.3001C5.1 45.1001 6.9 48.7001 9.3 51.8001C11.8 54.9001 14.8 57.5001 18.3 59.5001C21.8 61.5001 25.6 62.7001 29.5 63.2001C33.4 63.7001 37.5 63.4001 41.3 62.3001C45.1 61.2001 48.7 59.4001 51.8 57.0001C54.9 54.5001 57.5 51.5001 59.5 48.0001C61.5 44.5001 62.7 40.7001 63.2 36.8001C63.7 32.9001 63.4 28.8001 62.3 25.0001C61.2 21.2001 59.4 17.6001 57 14.5001C54.5 11.4001 51.5 8.8001 48 6.8001C44.5 4.8001 40.7 3.6001 36.8 3.1001C32.8 2.6001 28.8 2.9001 25 4.0001C21.2 5.1001 17.6 6.9001 14.5 9.3001C11.4 11.8001 8.8 14.8001 6.8 18.3001C4.8 21.8001 3.6 25.6001 3.1 29.5001Z" fill="#44C0C6" />
      <path d="M37.6 3.20007C33.4 7.10007 29.3 12.5001 37.3 13.4001C50.2 15.0001 45.7 24.0001 31.2 23.0001C16.7 21.9001 19.5 32.6001 27.5 34.6001C32.4 35.8001 33.9 38.6001 34.3 41.1001V41.2001C34.1 42.5001 34.1 43.8001 34.2 45.0001C34.2 45.1001 34.2 45.3001 34.2 45.4001C34.6 49.5001 36.6 50.5001 39 50.8001C42.2 51.2001 45.2 44.7001 46.1 41.0001C47.4 35.4001 53.1 36.2001 53.6 29.1001C53.7 27.0001 59.1 27.6001 63 28.4001C61.1 15.7001 51 5.20007 37.6 3.20007Z" fill="#69D83A"/>
      <path opacity="0.5" d="M3.9 40.5C13.3 49.8 27.3 52.7 39.4 47.8C51.1 43.1 59.1 32.1 60 19.5C68 35.5 60.8 56.5 41 62.2C24.7 66.6 8.1 56.9 3.9 40.5Z" fill="black"/>
      <path d="M1.7 29.4C1.2 33.5 1.5 37.7001 2.6 41.7001C3.7 45.7001 5.6 49.4001 8.2 52.7001C10.8 56.0001 13.9 58.7001 17.6 60.7001C21.2 62.7001 25.2 64 29.3 64.5C33.4 65 37.6 64.7 41.6 63.6C45.6 62.5 49.3 60.6 52.6 58C55.9 55.4 58.6 52.3 60.6 48.6C62.6 45 63.9 41.0001 64.4 36.9001C64.9 32.8001 64.6 28.6 63.5 24.6C62.4 20.6 60.5 16.9 57.9 13.6C55.3 10.3 52.2 7.60005 48.5 5.60005C44.9 3.60005 40.9 2.30005 36.8 1.80005C32.7 1.30005 28.5 1.60005 24.5 2.70005C20.5 3.80005 16.8 5.70005 13.5 8.30005C10.2 10.9 7.5 14.0001 5.5 17.7001C3.5 21.2001 2.2 25.2 1.7 29.4Z" stroke="white" stroke-width="3" />
    </g>
    <g id="MoonFront" transform="translate(26.55 26.55)">
      <path d="M6.41862 14.1364C9.61415 15.2034 13.0696 13.4778 14.1365 10.2823C15.2034 7.08677 13.4779 3.63136 10.2823 2.56443C7.08681 1.49749 3.63141 3.22305 2.56447 6.41858C1.49753 9.6141 3.2231 13.0695 6.41862 14.1364Z" fill="#A9C7C2"/>
      <path opacity="0.5" d="M3.38397 11.8581C9.07497 14.0745 12.7124 12.3371 14.2331 6.83547C14.9905 9.93488 13.6293 12.7486 10.7826 14.0121C8.09414 15.1176 5.12204 14.2307 3.38397 11.8581Z" fill="black"/>
      <path d="M6.41862 14.1364C9.61415 15.2034 13.0696 13.4778 14.1365 10.2823C15.2034 7.08677 13.4779 3.63136 10.2823 2.56443C7.08681 1.49749 3.63141 3.22305 2.56447 6.41858C1.49753 9.6141 3.2231 13.0695 6.41862 14.1364Z" stroke="white" stroke-miterlimit="10"/>
    </g>
  </g>
</template>

<script setup lang="ts">
import { gsap } from 'gsap';
import { onMounted } from 'vue';

defineOptions({ name: 'SVGPathEarth' });

onMounted(() => {
  const moonFront = document.querySelector('#MoonFront') as SVGPathElement;
  const moonBack = document.querySelector('#MoonBack') as SVGPathElement;

  const orbitRadiusX = 50; // horizontal
  const orbitRadiusY = 15; // vertical
  const incline = 0.3; // coefficient d'inclinaison, 0 = horizontale, >0 = inclinée

  const earthCenter = { x: 33.15, y: 33.15 };

  function onUpdate() {
    // theta de 0 à 2π
    const t = this.progress(); // 0 → 1
    const theta = t * Math.PI * 2;

    const x0 = orbitRadiusX * Math.cos(theta) - incline * orbitRadiusY * Math.sin(theta);
    const y0 = orbitRadiusY * Math.sin(theta) + incline * orbitRadiusX * Math.cos(theta);

    const moonX = earthCenter.x + x0;
    const moonY = earthCenter.y + y0;

    gsap.set(moonFront, { x: moonX - 6.6, y: moonY - 6.6 });
    gsap.set(moonBack, { x: moonX - 6.6, y: moonY - 6.6 });

    // masque derrière Terre
    moonFront.style.opacity = moonY < earthCenter.y ? '0' : '1';
    moonBack.style.opacity = moonY < earthCenter.y ? '1' : '0';
  }

  gsap.to({}, {
    duration: 10,
    repeat: -1,
    ease: 'linear',
    onUpdate,
  });
});
</script>
